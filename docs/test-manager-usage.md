# Компонент TestManager

## Обзор

Компонент TestManager - это Livewire-компонент, который заменяет старый компонент QuizForm. Он предоставляет более надежный и гибкий способ управления попытками прохождения тестов, отслеживания прогресса и отображения результатов.

## Возможности

- Отслеживает попытки прохождения тестов для каждого пользователя
- Поддерживает несколько попыток с настраиваемым максимальным количеством
- Показывает подробные результаты после каждой попытки
- Предоставляет экран с итоговым результатом, когда тест пройден или исчерпаны все попытки
- Сохраняет ответы по мере продвижения пользователя по тесту
- Позволяет навигацию между вопросами

## Состояния

Компонент имеет четыре основных состояния:

1. **initial_screen**: Отображает информацию о тесте и кнопку для начала
2. **test_form**: Показывает текущий вопрос и элементы навигации
3. **result**: Отображает подробные результаты после завершения попытки
4. **final**: Показывает итоговый статус (пройден или не пройден) при повторном посещении завершенного теста

## Использование

### Базовое использование

```php
<livewire:test-manager :quiz="$quiz" />
```

### Необходимые модели

Компонент требует следующие модели:

- `Quiz`: Тест, который проходит пользователь
- `Test`: Представляет попытку прохождения теста
- `Question`: Вопросы теста
- `QuestionOption`: Варианты ответов на вопросы
- `TestAnswer`: Ответы пользователя на вопросы

### Изменения в базе данных

Компонент требует следующие поля в таблице `tests`:

- `status`: Строка (pending, in_progress, completed)
- `current_attempt`: Целое число
- `passed`: Логическое значение
- `started_at`: Временная метка
- `completed_at`: Временная метка

Для добавления этих полей предоставлена миграция.

## Детали реализации

### Структура компонента

Компонент TestManager реализован как единый Livewire-компонент, который управляет различными состояниями внутренне, вместо использования отдельных классов состояний. Это упрощает реализацию, сохраняя при этом ту же функциональность.

### Шаблоны Blade

Компонент использует следующие шаблоны blade:

- `test-manager.blade.php`: Основной шаблон, который включает соответствующий шаблон состояния
- `test-manager/initial-screen.blade.php`: Начальный экран с информацией о тесте
- `test-manager/test-form.blade.php`: Форма теста с вопросами и навигацией
- `test-manager/result.blade.php`: Подробные результаты после попытки
- `test-manager/final.blade.php`: Экран итогового статуса

### Замена QuizForm

Чтобы заменить старый компонент QuizForm на TestManager:

1. Запустите миграцию для добавления необходимых полей в таблицу `tests`
2. Обновите все ссылки на `<livewire:quiz-form>`, чтобы использовать `<livewire:test-manager>` вместо них
3. Обновите все маршруты или контроллеры, которые передают данные компоненту

## Пример

```php
// В шаблоне blade
<livewire:test-manager :quiz="$quiz" />

// В контроллере
public function showQuiz(Quiz $quiz)
{
    return view('quizzes.show', compact('quiz'));
}
```
